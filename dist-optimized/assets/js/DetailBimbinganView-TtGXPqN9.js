import{A as e,C as t,E as n,F as r,I as i,L as a,M as o,N as s,S as c,T as l,b as u,d,f,g as p,h as m,m as h,p as g,s as _,v,w as y,y as b}from"./vendor-vue-CrbfGyrv.js";import{t as x}from"./index.optimized-DOL2Az7M.js";import{t as S}from"./supabase-CelTQgPn.js";const C=_(`bimbingan`,()=>{let e=s([]),t=s([]),n=s(!1),r=s(!1),i=s(null),a=s(null),o=m(()=>[...e.value].sort((e,t)=>new Date(t.tanggal)-new Date(e.tanggal))),c=m(()=>e.value.length===0?0:Math.max(...e.value.map(e=>e.progres))),l=m(()=>e.value.length);async function u(t){n.value=!0,i.value=null;try{let{data:n,error:r}=await S.getByJudulId(t);if(r)throw Error(r);e.value=n}catch(e){i.value=e.message}finally{n.value=!1}}async function d(e){r.value=!0,a.value=e;try{let{data:n,error:r}=await S.getChatHistory(e);if(r)throw Error(r);t.value=n}catch(e){i.value=e.message}finally{r.value=!1}}async function f(e){if(!(!a.value||!e.trim()))try{let{data:n,error:r}=await S.sendMessage(a.value,e);if(r)throw Error(r);t.value.push(n)}catch(e){i.value=e.message}}async function p(t){try{let{data:n,error:r}=await S.create(t);if(r)throw Error(r);return e.value.push(n),n}catch(e){return i.value=e.message,null}}return{bimbinganList:e,chatMessages:t,loading:n,chatLoading:r,error:i,selectedBimbinganId:a,sortedBimbingan:o,latestProgres:c,totalBimbingan:l,fetchBimbingan:u,fetchChat:d,sendMessage:f,tambahBimbingan:p}});var w={class:`chat-container`},T={class:`chat-header`},E={class:`chat-header-info`},D={class:`chat-count`},O={key:0,class:`chat-loading`},k={key:0,class:`chat-empty`},A={class:`bubble-sender`},j={class:`bubble-text`},M={class:`bubble-time`},N={class:`chat-input-area`},P=[`disabled`],F=x({__name:`ChatHistory`,props:{messages:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:[`send`],setup(i,{emit:c}){let u=i,m=c,g=s(``),_=s(null);function y(e){return e?new Date(e.replace(` `,`T`)).toLocaleString(`id-ID`,{day:`2-digit`,month:`short`,hour:`2-digit`,minute:`2-digit`}):``}function x(){g.value.trim()&&(m(`send`,g.value.trim()),g.value=``)}return e(()=>u.messages.length,async()=>{await t(),_.value&&(_.value.scrollTop=_.value.scrollHeight)}),(e,t)=>(l(),b(`div`,w,[p(`div`,T,[p(`div`,E,[t[1]||(t[1]=p(`h4`,null,`ðŸ’¬ Riwayat Diskusi Bimbingan`,-1)),p(`span`,D,a(i.messages.length)+` pesan`,1)])]),p(`div`,{class:`chat-messages`,ref_key:`chatArea`,ref:_},[i.loading?(l(),b(`div`,O,[...t[2]||(t[2]=[p(`div`,{class:`skeleton`,style:{height:`48px`,width:`60%`,"margin-bottom":`12px`}},null,-1),p(`div`,{class:`skeleton`,style:{height:`48px`,width:`50%`,"margin-left":`auto`,"margin-bottom":`12px`}},null,-1),p(`div`,{class:`skeleton`,style:{height:`48px`,width:`65%`}},null,-1)])])):(l(),b(h,{key:1},[i.messages.length===0?(l(),b(`div`,k,[...t[3]||(t[3]=[p(`p`,null,`Belum ada pesan dalam sesi bimbingan ini.`,-1)])])):v(``,!0),(l(!0),b(h,null,n(i.messages,e=>(l(),b(`div`,{key:e.id,class:r([`chat-bubble`,e.sender===`mahasiswa`?`bubble-sent`:`bubble-received`])},[p(`div`,A,a(e.sender===`mahasiswa`?`ðŸ‘¤ Anda`:`ðŸ‘¨â€ðŸ« Dosen`),1),p(`div`,j,a(e.pesan),1),p(`div`,M,a(y(e.waktu)),1)],2))),128))],64))],512),p(`div`,N,[o(p(`input`,{"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),type:`text`,class:`chat-input`,placeholder:`Ketik pesan...`,onKeyup:f(x,[`enter`])},null,544),[[d,g.value]]),p(`button`,{class:`chat-send-btn`,onClick:x,disabled:!g.value.trim()},[...t[4]||(t[4]=[p(`svg`,{width:`18`,height:`18`,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,"stroke-width":`2`},[p(`line`,{x1:`22`,y1:`2`,x2:`11`,y2:`13`}),p(`polygon`,{points:`22 2 15 22 11 13 2 9 22 2`})],-1)])],8,P)])]))}},[[`__scopeId`,`data-v-404a89e5`]]),I={class:`detail-bimbingan`},L={class:`bimbingan-layout`},R={class:`bimbingan-left`},z={class:`progress-section card`},B={class:`progress-header`},V={class:`progress-pct`},H={class:`big-progress-bar`},U={class:`form-section card`},W={class:`form-group`},G={class:`form-group`},K={class:`form-group`},q={class:`form-group`},J={class:`timeline-section card`},Y={key:0,class:`loading-timeline`},X={key:1,class:`timeline`},Z=[`onClick`],Q={class:`timeline-content`},$={class:`timeline-header`},ee={class:`timeline-date`},te={class:`timeline-topik`},ne={class:`timeline-catatan`},re={class:`timeline-progres`},ie={class:`mini-progress`},ae={class:`bimbingan-right`},oe=x({__name:`DetailBimbinganView`,setup(e){let t=C(),f=s({tanggal:new Date().toISOString().slice(0,10),topik:``,catatan:``,progres:0}),_=m(()=>t.loading),v=m(()=>t.chatLoading),x=m(()=>t.sortedBimbingan),S=m(()=>t.chatMessages),w=m(()=>t.latestProgres),T=m(()=>t.selectedBimbinganId);function E(e){t.fetchChat(e)}async function D(){await t.tambahBimbingan({judul_id:1,...f.value}),f.value={tanggal:new Date().toISOString().slice(0,10),topik:``,catatan:``,progres:0}}function O(e){t.sendMessage(e)}function k(e){return new Date(e).toLocaleDateString(`id-ID`,{day:`2-digit`,month:`long`,year:`numeric`})}return y(()=>{t.fetchBimbingan(1),t.fetchChat(5)}),(e,t)=>(l(),b(`div`,I,[p(`div`,L,[p(`div`,R,[p(`div`,z,[p(`div`,B,[t[4]||(t[4]=p(`h3`,null,`ðŸ“ˆ Progres Keseluruhan`,-1)),p(`span`,V,a(w.value)+`%`,1)]),p(`div`,H,[p(`div`,{class:`big-progress-fill`,style:i({width:w.value+`%`})},null,4)])]),p(`div`,U,[t[10]||(t[10]=p(`h3`,{class:`form-title`},`âž• Catatan Bimbingan Baru`,-1)),p(`form`,{onSubmit:g(D,[`prevent`]),class:`bimbingan-form`},[p(`div`,W,[t[5]||(t[5]=p(`label`,{class:`form-label`},`Tanggal`,-1)),o(p(`input`,{"onUpdate:modelValue":t[0]||(t[0]=e=>f.value.tanggal=e),type:`date`,class:`form-input`,required:``},null,512),[[d,f.value.tanggal]])]),p(`div`,G,[t[6]||(t[6]=p(`label`,{class:`form-label`},`Topik Bimbingan`,-1)),o(p(`input`,{"onUpdate:modelValue":t[1]||(t[1]=e=>f.value.topik=e),type:`text`,class:`form-input`,placeholder:`Misal: Review BAB III`,required:``},null,512),[[d,f.value.topik]])]),p(`div`,K,[t[7]||(t[7]=p(`label`,{class:`form-label`},`Catatan / Hasil`,-1)),o(p(`textarea`,{"onUpdate:modelValue":t[2]||(t[2]=e=>f.value.catatan=e),class:`form-input form-textarea`,rows:`3`,placeholder:`Catatan dari sesi bimbingan...`,required:``},null,512),[[d,f.value.catatan]])]),p(`div`,q,[t[8]||(t[8]=p(`label`,{class:`form-label`},`Progres (%)`,-1)),o(p(`input`,{"onUpdate:modelValue":t[3]||(t[3]=e=>f.value.progres=e),type:`number`,class:`form-input`,min:`0`,max:`100`,required:``},null,512),[[d,f.value.progres,void 0,{number:!0}]])]),t[9]||(t[9]=u(`<button type="submit" class="btn-primary" data-v-0fc0cf6b><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-v-0fc0cf6b><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" data-v-0fc0cf6b></path><polyline points="17 21 17 13 7 13 7 21" data-v-0fc0cf6b></polyline><polyline points="7 3 7 8 15 8" data-v-0fc0cf6b></polyline></svg> Simpan Catatan </button>`,1))],32)]),p(`div`,J,[t[11]||(t[11]=p(`h3`,{class:`timeline-title`},`ðŸ“‹ Riwayat Bimbingan`,-1)),_.value?(l(),b(`div`,Y,[(l(),b(h,null,n(3,e=>p(`div`,{key:e,class:`skeleton`,style:{height:`80px`,"margin-bottom":`12px`}})),64))])):(l(),b(`div`,X,[(l(!0),b(h,null,n(x.value,e=>(l(),b(`div`,{key:e.id,class:r([`timeline-item`,{active:T.value===e.id}]),onClick:t=>E(e.id)},[p(`div`,{class:r([`timeline-dot`,e.status===`Selesai`?`done`:`in-progress`])},null,2),p(`div`,Q,[p(`div`,$,[p(`span`,ee,a(k(e.tanggal)),1),p(`span`,{class:r([`badge`,e.status===`Selesai`?`badge-success`:`badge-info`])},a(e.status),3)]),p(`h4`,te,a(e.topik),1),p(`p`,ne,a(e.catatan),1),p(`div`,re,[p(`div`,ie,[p(`div`,{class:`mini-fill`,style:i({width:e.progres+`%`})},null,4)]),p(`span`,null,a(e.progres)+`%`,1)])])],10,Z))),128))]))])]),p(`div`,ae,[c(F,{messages:S.value,loading:v.value,onSend:O},null,8,[`messages`,`loading`])])])]))}},[[`__scopeId`,`data-v-0fc0cf6b`]]);export{oe as default};